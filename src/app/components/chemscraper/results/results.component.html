<div class="page_container">
    <div class="container">
        <div class="header">
            <div class="info">
                <h3>
                    Job ID: {{jobID}}
                    <i class="pi pi-copy copy_and_paste_button" (click)="copyAndPasteURL()"></i>
                </h3>

                <div class="details">
                    <div class="sequence_time">Submission Time: {{statusResponse?.created_at | date:'short' }}</div>
                </div>
            </div>

            <div class="spacer"></div>

            <div class="buttons">
                <button *ngIf="!contentLoaded" pButton label="Cancel" class="p-button-outlined p-button-secondary p-button-xs"></button>
                <a pButton label="Run a new Request" icon="pi pi-plus" class="p-button-outlined p-button-sm"
                    target="_blank" [routerLink]="['/configuration']"></a>
            </div>
        </div>

        <div class="loader" *ngIf="!contentLoaded">
            <div class="loadingTitle">
                <h3>
                    Working on your analysis
                </h3>
                <p>Estimated time remaining: 1 minute and 30 seconds
                </p>
            </div>
            <p-steps id="LoadingStages" [model]="stages" [activeIndex]="activeStage" [readonly]="true"></p-steps>

            <div class="loadingDiv">
              <div><p-progressSpinner></p-progressSpinner></div>
              <div><p>Analyzing molecules</p></div>
            </div>
        </div>

        <div class="card" *ngIf="useExample">
            <p-messages [(value)]="preComputedMessage" [enableService]="false" [closable]="false"></p-messages>
        </div>

        <ng-container *ngIf="contentLoaded">
          <p-panel styleClass="padded">
            <ng-template pTemplate="header">
              <div class="result-header-container">
                <div>
                  <p-button (click)="DocsDropdown.toggle($event)" styleClass="ui-button-success">
                    <i class="p-button-icon-left pi pi-file-pdf"></i> Documents <i class="p-button-icon-right pi pi-angle-down"></i>
                  </p-button>
                  <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                    <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
                  </p-overlayPanel>
                </div>
                <div>
                  <p-button (click)="DocsDropdown.toggle($event)" styleClass="ui-button-success">
                    <i class="p-button-icon-left pi pi-download"></i> Export <i class="p-button-icon-right pi pi-angle-down"></i>
                  </p-button>
                  <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                    <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
                  </p-overlayPanel>
                </div>
              </div>
            </ng-template>
            <div class="result-container">
              <div class="column1" [ngClass]="{'collapsed': !splitView}">
                <!-- Content for column 1 goes here -->
                <div class="example_data">
                  <chemscraper-pdf-viewer pdfUrl="../assets/or100.09.tables.pdf" [highlightBoxes]="highlightBoxes"></chemscraper-pdf-viewer>
                </div>
              </div>
              <div class="column2">
                <!-- Content for column 2 goes here -->
                <div class="search-row">
                  <input pInputText placeholder="Search by SMILES" [(ngModel)]="searchText" class="search-input" />
                  <button pButton type="button" class="filter-button p-button-outlined p-button-sm" (click)="filterResults()"> <i class="p-button-icon-left pi pi-filter"></i> Filter </button>
                </div>
                <div class="sort-row">
                  <div class="sort-text">
                    Showing 17 identified molecules
                  </div>
                  <button pButton type="button" class="sort-button p-button-text" (click)="sortResults()"> Sort by <i class="p-button-icon-right pi pi-chevron-down"></i></button>
                </div>
                <div class="table-container">
                  <p-table [value]="molecules" dataKey="name" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 25]" [scrollable]="true" scrollHeight="300px">
                    <ng-template pTemplate="header">
                      <tr>
                        <th style="width: 3em"><p-tableCheckbox></p-tableCheckbox></th>
                        <th pSortableColumn="name">Molecule<p-sortIcon field="name"></p-sortIcon></th>
                        <th>Structure</th>
                        <th>SMILE</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-molecule let-expanded="expanded">
                      <tr>
                        <td><p-tableCheckbox [value]="molecule" (click)="selectRow($event)"></p-tableCheckbox></td>
                        <td> <i [pRowToggler]="molecule" [ngClass]="expanded ? 'pi pi-chevron-down p-button-icon-left' : 'pi pi-chevron-right p-button-icon-left'"></i> {{ molecule.name }}</td>
                        <td>{{ molecule.structure }}</td>
                        <td>{{ molecule.SMILE }}</td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion">
                      <tr>
                        <td colspan="4">
                          <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse sed erat purus. Vivamus mattis varius iaculis. Suspendisse dapibus pretium ornare. Donec mollis semper diam tincidunt tristique. Mauris et quam at purus pellentesque eleifend ut et turpis. Quisque iaculis, enim consequat sollicitudin tempor, diam dolor ornare lorem, ac finibus velit lectus vel nisl. Etiam nec fermentum felis. Suspendisse a mauris orci. Praesent sem sapien, ultrices blandit metus vitae, rhoncus mattis mi. Duis a nisl at lorem rhoncus congue vel vitae nulla. Aliquam lorem sem, gravida id ante in, auctor suscipit nisi. Maecenas ut lectus eget lorem blandit molestie. Nullam maximus pretium metus, sed lobortis dolor vulputate a.
                          </p>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
            <button (click)="toggleSplitView()">Collapse/Expand Column 1</button>

          </p-panel>

          <p-sidebar [(visible)]="filterPanelVisible" position="right">
            <h3>Right Sidebar</h3>
          </p-sidebar>

          <div class="failJob" *ngIf="failedJob">
              <p-messages [(value)]="jobFailedMessage" [enableService]="false" [closable]="false"></p-messages>
          </div>
        </ng-container>
    </div>
</div>
