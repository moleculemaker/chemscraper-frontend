<div class="page_container">
    <div class="container">
        <div class="header">
            <div class="info">
                <h3>
                    Job ID: {{jobID}}
                    <i class="pi pi-copy copy_and_paste_button" (click)="copyAndPasteURL()"></i>
                </h3>

                <!-- <div class="details">
                    <div class="sequence_time">Submission Time: {{statusResponse?.created_at | date:'short' }}</div>
                </div> -->
            </div>

            <div class="spacer"></div>

            <div class="buttons">
                <!-- <button *ngIf="!contentLoaded" pButton label="Cancel" class="p-button-outlined p-button-secondary p-button-xs"></button> -->
                <a pButton label="Run a new Request" icon="pi pi-plus" class="p-button-outlined p-button-sm"
                    target="_blank" [routerLink]="['/configuration']"></a>
            </div>
        </div>

        <div class="loader" *ngIf="!contentLoaded">
            <div class="loadingTitle">
                <h3>
                    Working on your analysis
                </h3>
                <!-- <p>Estimated time remaining: 1 minute and 30 seconds
                </p> -->
            </div>
            <!-- <p-steps id="LoadingStages" [model]="stages" [activeIndex]="activeStage" [readonly]="true"></p-steps> -->

            <div class="loadingDiv">
              <div><p-progressSpinner></p-progressSpinner></div>
              <div><p>{{stages[activeStage].label}}</p></div>
            </div>
        </div>

        <div class="card" *ngIf="useExample">
            <p-messages [(value)]="preComputedMessage" [enableService]="false" [closable]="false"></p-messages>
        </div>

        <ng-container *ngIf="contentLoaded">
          <p-panel styleClass="padded">
            <ng-template pTemplate="header">
              <div class="title">
                Results
              </div>


              <div class="spacer"></div>
              <div><p-button (click)="ExportDropdown.toggle($event)" styleClass="ui-button-success">
                <i class="p-button-icon-left pi pi-download"></i> Export
              </p-button></div>
              <p-overlayPanel styleClass="export-menu" #ExportDropdown>
                <chemscraper-export-menu [tableRows]="resultsTable.value" [pages_count]="pages_count"></chemscraper-export-menu>
              </p-overlayPanel>
            </ng-template>

            <div class="result-header-container">
              <p-button (click)="DocsDropdown.toggle($event)" styleClass="p-button-outlined ui-button-success">
                <i class="p-button-icon-left pi pi-file-pdf"></i> Documents <i class="p-button-icon-right pi pi-angle-down"></i>
              </p-button>

              <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
              </p-overlayPanel>

              <div class="spacer"></div>

              <!-- <div class="header_group">
                <div class="label">Apply document as table filter</div>
                <p-selectButton [options]="tableFilterStateOptions" [(ngModel)]="tableFilterValue" optionLabel="label" optionValue="value"></p-selectButton>
              </div> -->
            </div>
            <div class="result-container">
              <!-- <div class="column1" [ngClass]="{'collapsed': !splitView}">
                <p-button class="toggle_splitview_button" styleClass="p-button-outlined p-button-xs"
                  [icon]="(splitView) ? 'pi pi-chevron-left' : 'pi pi-chevron-right'"
                  (click)="toggleSplitView()"
                ></p-button>

                <div class="content">
                  <div class="document-path-bar">
                    Document Center > <span class="pdf_name">{{currentPDFName}}</span>
                  </div>

                  <div id="input_pdf_container" class="input_pdf_container">
                    <chemscraper-pdf-viewer *ngIf="pdfURLs.length > 0" pdfUrl="{{currentPDF}}" [highlightBoxes]="highlightBoxes" (scrollToMolecule)="goToRow($event)"></chemscraper-pdf-viewer>
                  </div>
                </div>
              </div> -->

              <div class="column2">
                <!-- Content for column 2 goes here -->
                <!-- <div class="search-row">
                  <input pInputText placeholder="Search by SMILES" [(ngModel)]="searchText" class="search-input" />
                  <button pButton type="button" class="filter-button p-button-outlined p-button-sm" (click)="filterResults()"> <i class="p-button-icon-left pi pi-filter"></i> Filter </button>
                </div> -->
                <div class="sort-row">
                  <div class="sort-text">
                    Showing {{molecules.length}} identified molecules
                  </div>
                  <!-- <button pButton type="button" class="sort-button p-button-text" (click)="sortResults()"> Sort by <i class="p-button-icon-right pi pi-chevron-down"></i></button> -->
                </div>
                <div class="table-container">
                  <p-table #resultsTable [value]="molecules" dataKey="id" selectionMode="single" [(selection)]="selectedMolecule" (onRowSelect)="onRowSelected($event)" (onRowUnselect)="onRowUnselected($event)" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 25]" [scrollable]="true" scrollHeight="700px" styleClass="molecule_table" [(first)]="firstRowIndex">
                    <ng-template pTemplate="header">
                      <tr>
                        <!-- <th><p-tableCheckbox></p-tableCheckbox></th> -->
                        <th pSortableColumn="name">Molecule<p-sortIcon field="name"></p-sortIcon></th>
                        <th>Structure (Extracted)</th>
                        <th>Structure (Original)</th>
                        <th>SMILES</th>
                        <!-- <th *ngIf="!splitView">Document</th> -->
                        <th *ngIf="!splitView">Page</th>
                        <th *ngIf="!splitView">PubChem CID</th>
                        <th *ngIf="!splitView">Confidence</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-molecule let-expanded="expanded">
                      <tr [pSelectableRow]="molecule" [pRowToggler]="molecule">
                        <td> <i [ngClass]="expanded ? 'pi pi-chevron-down p-button-icon-left' : 'pi pi-chevron-right p-button-icon-left'"></i> {{ molecule.name }}</td>
                        <td class="svg-column" [innerHTML]="molecule.structure"></td>
                        <td>
                          <chemscraper-pdf-context-viewer *ngIf="pdfURLs.length > 0" pdfUrl="{{currentPDF}}" [startX]="molecule.minX" [startY]="molecule.minY" [width]="molecule.width" [height]="molecule.height" [pageNumber]="molecule.page_no" [showContext]="false"></chemscraper-pdf-context-viewer>
                        </td>
                        <td>{{ molecule.SMILE }}</td>
                        <td *ngIf="!splitView">{{ molecule.page_no }}</td>
                        <td *ngIf="!splitView">{{ molecule.PubChemCID }}</td>
                        <td *ngIf="!splitView">{{ molecule.confidence }}</td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-molecule>
                      <tr>
                        <td colspan="9">
                          <div class="result-molecules-details-container">
                            <p-panel>
                              <ng-template pTemplate="header">

                              </ng-template>
                              <button (click)="similaritySort(molecule.SMILE)">View Similar Structres</button>
                              <div class="molecule-info-container">

                                <div class="molecule-details-container">
                                  <div class="molecule-details-col1">
                                    <div>
                                      <p class="molecule-details-header">Results Summary</p>
                                      <p>Identified, Found {{molecule.OtherInstances.length}} time(s) in 1 document</p>
                                    </div>
                                    <div>
                                      <p class="molecule-details-header">Location</p>
                                      <p>{{currentPDFName}}{{molecule.Location}}</p>
                                    </div>
                                    <div>
                                      <p class="molecule-details-header">Other Instances</p>
                                      <p>{{currentPDFName}} | page(s): {{molecule.OtherInstances.join(', ')}}</p>
                                    </div>
                                  </div>
                                  <div class="molecule-details-col2">
                                    <div>
                                      <p class="molecule-details-header">Molecular Information</p>
                                      <p>Formula: {{molecule.molecularFormula}} <br>
                                        Weight: {{molecule.molecularWeight}} g/mol</p>
                                    </div>
                                    <div>
                                      <p class="molecule-details-header">Chemical Safety</p>
                                      <p *ngIf="molecule.chemicalSafety.length > 0"><span *ngFor="let chemicalSafetyProperty of molecule.chemicalSafety">{{chemicalSafetyProperty}}</span></p>
                                      <p *ngIf="molecule.chemicalSafety.length == 0">Unavailable</p>
                                    </div>
                                    <div>
                                      <p class="molecule-details-header">External References</p>
                                      <p>PubChem ID: {{molecule.PubChemCID}}</p>
                                    </div>
                                  </div>
                                  <div class="description" [ngClass]="splitView ? 'molecule-details-row2' : 'molecule-details-col3'">
                                    <p class="molecule-details-header">Description</p>
                                    <p>{{molecule.Description}}</p>
                                  </div>
                                </div>
                                <div class="molecule-structure-info-container">
                                  <p>Structural Information</p>
                                  <div class="structural-info-container">
                                    <div class="extracted-structure-container">
                                      <p>Extracted Structure</p>
                                      <div class="bordered-div" [innerHTML]="molecule.structure"></div>
                                    </div>
                                    <div class="original-structure-container">
                                      <p>Original Structure</p>
                                      <div class="bordered-div">
                                        <chemscraper-pdf-context-viewer *ngIf="pdfURLs.length > 0" pdfUrl="{{currentPDF}}" [startX]="molecule.minX" [startY]="molecule.minY" [width]="molecule.width" [height]="molecule.height" [pageNumber]="molecule.page_no" [showContext]="false"></chemscraper-pdf-context-viewer>
                                      </div>
                                    </div>
                                    <div class="SMILES-container">
                                      <p>SMILES</p>
                                      <div>{{ molecule.SMILE }}</div>
                                    </div>
                                  </div>
                                  <div class="original-context-container">
                                    <p>Original Context</p>
                                    <button (click)="OpenPDFOverlay(molecule.id)">Open in PDF viewer</button>
                                    <div class="bordered-div">
                                      <chemscraper-pdf-context-viewer *ngIf="pdfURLs.length > 0" pdfUrl="{{currentPDF}}" [startX]="molecule.minX" [startY]="molecule.minY" [width]="molecule.width" [height]="molecule.height" [pageNumber]="molecule.page_no" [showContext]="true"></chemscraper-pdf-context-viewer>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </p-panel>
                          </div>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
          </p-panel>

          <p-sidebar [(visible)]="filterPanelVisible" position="right">
            <h3>Right Sidebar</h3>
          </p-sidebar>

          <div class="failJob" *ngIf="failedJob">
              <p-messages [(value)]="jobFailedMessage" [enableService]="false" [closable]="false"></p-messages>
          </div>
        </ng-container>
    </div>
</div>
