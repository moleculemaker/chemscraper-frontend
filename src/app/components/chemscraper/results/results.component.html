<div class="page_container">
    <div class="container">
        <div class="header">
            <div class="info">
                <h3>
                    Job ID: {{jobID}}
                    <i class="pi pi-copy copy_and_paste_button" (click)="copyAndPasteURL()"></i>
                </h3>

                <!-- <div class="details">
                    <div class="sequence_time">Submission Time: {{statusResponse?.created_at | date:'short' }}</div>
                </div> -->
            </div>

            <div class="spacer"></div>

            <div class="buttons">
                <!-- <button *ngIf="!contentLoaded" pButton label="Cancel" class="p-button-outlined p-button-secondary p-button-xs"></button> -->
                <a pButton label="Run a new Request" icon="pi pi-plus" class="p-button-outlined p-button-sm"
                    target="_blank" [routerLink]="['/configuration']"></a>
            </div>
        </div>

        <div class="loader" *ngIf="!contentLoaded">
            <div class="loadingTitle">
                <h3>
                    Working on your analysis
                </h3>
                <!-- <p>Estimated time remaining: 1 minute and 30 seconds
                </p> -->
            </div>
            <!-- <p-steps id="LoadingStages" [model]="stages" [activeIndex]="activeStage" [readonly]="true"></p-steps> -->

            <div class="loadingDiv">
              <div><p-progressSpinner></p-progressSpinner></div>
              <div><p>{{stages[activeStage].label}}</p></div>
            </div>
        </div>

        <div class="card" *ngIf="useExample">
            <p-messages [(value)]="preComputedMessage" [enableService]="false" [closable]="false"></p-messages>
        </div>

        <ng-container *ngIf="contentLoaded">
          <p-panel styleClass="padded">
            <ng-template pTemplate="header">
              <div class="title">
                <!-- <p-button (click)="DocsDropdown.toggle($event)" styleClass="ui-button-success">
                  <i class="p-button-icon-left pi pi-file-pdf"></i> Documents <i class="p-button-icon-right pi pi-angle-down"></i>
                </p-button>
                <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                  <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
                </p-overlayPanel> -->
                Results
              </div>

              <div class="spacer"></div>

              <div>
                <p-button (click)="DocsDropdown.toggle($event)" styleClass="ui-button-success">
                  <i class="p-button-icon-left pi pi-download"></i> Export
                </p-button>
                <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                  <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
                </p-overlayPanel>
              </div>
            </ng-template>

            <div class="result-header-container">
              <p-button (click)="DocsDropdown.toggle($event)" styleClass="p-button-outlined ui-button-success">
                <i class="p-button-icon-left pi pi-file-pdf"></i> Documents <i class="p-button-icon-right pi pi-angle-down"></i>
              </p-button>

              <p-overlayPanel styleClass="files-overlay" #DocsDropdown>
                <p-listbox [options]="fileNames" [(ngModel)]="selectedFile" [style]="{'width':'15rem'}"></p-listbox>
              </p-overlayPanel>

              <div class="spacer"></div>

              <!-- <div class="header_group">
                <div class="label">Apply document as table filter</div>
                <p-selectButton [options]="tableFilterStateOptions" [(ngModel)]="tableFilterValue" optionLabel="label" optionValue="value"></p-selectButton>
              </div> -->
            </div>
            <div class="result-container">
              <div class="column1" [ngClass]="{'collapsed': !splitView}">
                <p-button class="toggle_splitview_button" styleClass="p-button-outlined p-button-xs"
                  [icon]="(splitView) ? 'pi pi-chevron-left' : 'pi pi-chevron-right'"
                  (click)="toggleSplitView()"
                ></p-button>

                <div class="content">
                  <!-- Content for column 1 goes here -->
                  <div class="document-path-bar">
                    Document Center > <span class="pdf_name">{{currentPDFName}}</span>
                  </div>

                  <div id="input_pdf_container" class="input_pdf_container">
                    <chemscraper-pdf-viewer *ngIf="pdfURLs.length > 0" pdfUrl="{{currentPDF}}" [highlightBoxes]="highlightBoxes"></chemscraper-pdf-viewer>
                  </div>
                </div>
              </div>
              <div class="column2">
                <!-- Content for column 2 goes here -->
                <!-- <div class="search-row">
                  <input pInputText placeholder="Search by SMILES" [(ngModel)]="searchText" class="search-input" />
                  <button pButton type="button" class="filter-button p-button-outlined p-button-sm" (click)="filterResults()"> <i class="p-button-icon-left pi pi-filter"></i> Filter </button>
                </div> -->
                <div class="sort-row">
                  <div class="sort-text">
                    Showing {{molecules.length}} identified molecules
                  </div>
                  <!-- <button pButton type="button" class="sort-button p-button-text" (click)="sortResults()"> Sort by <i class="p-button-icon-right pi pi-chevron-down"></i></button> -->
                </div>
                <div class="table-container">
                  <p-table [value]="molecules" dataKey="id" selectionMode="single" [(selection)]="selectedMolecule" (onRowSelect)="onRowSelected($event)" (onRowUnselect)="onRowUnselected($event)" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 25]" [scrollable]="true" scrollHeight="600px" styleClass="molecule_table">
                    <ng-template pTemplate="header">
                      <tr>
                        <!-- <th><p-tableCheckbox></p-tableCheckbox></th> -->
                        <th pSortableColumn="name">Molecule<p-sortIcon field="name"></p-sortIcon></th>
                        <th>Structure</th>
                        <th>SMILES</th>
                        <!-- <th *ngIf="!splitView">Document</th> -->
                        <th *ngIf="!splitView">Page</th>
                        <th *ngIf="!splitView">PubChem CID</th>
                        <th *ngIf="!splitView">Confidence</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-molecule let-expanded="expanded">
                      <tr [pSelectableRow]="molecule" [pRowToggler]="molecule">
                        <!-- <td ><p-tableCheckbox [value]="molecule" (click)="selectRow($event)"></p-tableCheckbox></td> -->
                        <td> <i [ngClass]="expanded ? 'pi pi-chevron-down p-button-icon-left' : 'pi pi-chevron-right p-button-icon-left'"></i> {{ molecule.name }}</td>
                        <td [innerHTML]="molecule.structure"></td>
                        <td>{{ molecule.SMILE }}</td>
                        <!-- <td *ngIf="!splitView">{{ molecule.doc_no }}</td> -->
                        <td *ngIf="!splitView">{{ molecule.page_no }}</td>
                        <td *ngIf="!splitView">{{ molecule.PubChemCID }}</td>
                        <td *ngIf="!splitView">{{ molecule.confidence }}</td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-molecule>
                      <tr>
                        <td colspan="9">
                          <div class="result-molecules-details-container">
                            <p-panel>
                              <ng-template pTemplate="header">
                                <!-- <div class="header-buttons-container">
                                  <div class="tag-buttons">
                                    <p-button label="View in context" icon="pi pi-file" styleClass="p-button-sm p-button-outlined p-button-secondary result-molecules-details-button"></p-button>
                                    <p-button label="View similar structures" styleClass="p-button-sm p-button-outlined p-button-secondary result-molecules-details-button">
                                      <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M11.001 8.5C11.6514 8.49981 12.2842 8.28822 12.8039 7.89712C13.3236 7.50601 13.7022 6.95659 13.8825 6.33163C14.0628 5.70668 14.0351 5.04005 13.8036 4.4322C13.5721 3.82435 13.1493 3.30821 12.5989 2.96156C12.0485 2.6149 11.4004 2.45652 10.7522 2.51026C10.104 2.56401 9.49076 2.82698 9.00499 3.25954C8.51922 3.69211 8.1872 4.27083 8.05896 4.90851C7.93071 5.54619 8.01319 6.20828 8.29397 6.795L5.95397 7.965C5.53976 7.66947 5.04523 7.50736 4.53644 7.50034C4.02766 7.49333 3.52884 7.64173 3.10663 7.92572C2.68443 8.20972 2.35893 8.61578 2.17362 9.08968C1.98832 9.56357 1.95203 10.0827 2.06961 10.5778C2.18719 11.0729 2.45303 11.5203 2.83163 11.8602C3.21022 12.2002 3.68354 12.4165 4.18836 12.4804C4.69318 12.5442 5.20545 12.4525 5.65675 12.2174C6.10804 11.9824 6.47687 11.6152 6.71397 11.165L9.00997 12.313C8.96453 12.7974 9.0972 13.2817 9.38315 13.6753C9.6691 14.0689 10.0887 14.3448 10.5634 14.4513C11.0381 14.5578 11.5354 14.4876 11.9621 14.2539C12.3888 14.0202 12.7156 13.6389 12.8814 13.1815C13.0473 12.7242 13.0407 12.222 12.863 11.7691C12.6852 11.3163 12.3485 10.9437 11.9159 10.7212C11.4832 10.4987 10.9843 10.4416 10.5125 10.5604C10.0408 10.6793 9.62853 10.9661 9.35297 11.367L6.99397 10.187C7.0332 9.6785 6.91521 9.17022 6.65597 8.731L8.87897 7.621C9.15727 7.90016 9.48802 8.12153 9.8522 8.27239C10.2164 8.42324 10.6068 8.5006 11.001 8.5ZM11.001 7.5C10.4705 7.5 9.96183 7.28929 9.58676 6.91422C9.21168 6.53914 9.00097 6.03044 9.00097 5.5C9.00097 4.96957 9.21168 4.46086 9.58676 4.08579C9.96183 3.71072 10.4705 3.5 11.001 3.5C11.5314 3.5 12.0401 3.71072 12.4152 4.08579C12.7903 4.46086 13.001 4.96957 13.001 5.5C13.001 6.03044 12.7903 6.53914 12.4152 6.91422C12.0401 7.28929 11.5314 7.5 11.001 7.5ZM4.50097 11.5C4.10315 11.5 3.72161 11.342 3.44031 11.0607C3.15901 10.7794 3.00097 10.3978 3.00097 10C3.00097 9.60218 3.15901 9.22065 3.44031 8.93934C3.72161 8.65804 4.10315 8.5 4.50097 8.5C4.89879 8.5 5.28033 8.65804 5.56163 8.93934C5.84294 9.22065 6.00097 9.60218 6.00097 10C6.00097 10.3978 5.84294 10.7794 5.56163 11.0607C5.28033 11.342 4.89879 11.5 4.50097 11.5ZM12.001 12.5C12.001 12.7652 11.8956 13.0196 11.7081 13.2071C11.5205 13.3946 11.2662 13.5 11.001 13.5C10.7358 13.5 10.4814 13.3946 10.2939 13.2071C10.1063 13.0196 10.001 12.7652 10.001 12.5C10.001 12.2348 10.1063 11.9804 10.2939 11.7929C10.4814 11.6054 10.7358 11.5 11.001 11.5C11.2662 11.5 11.5205 11.6054 11.7081 11.7929C11.8956 11.9804 12.001 12.2348 12.001 12.5Z" fill="#495057"/>
                                      </svg>
                                    </p-button>
                                  </div>
                                  <div class="flag-button">
                                    <i class="pi pi-flag"></i>
                                  </div>
                                </div> -->

                              </ng-template>
                              <div class="molecule-details-container">
                                <div class="molecule-details-col1">
                                  <div>
                                    <p class="molecule-details-header">Results Summary</p>
                                    <p>Identified, Found {{molecule.OtherInstances.length}} time(s) in 1 document</p>
                                  </div>
                                  <div>
                                    <p class="molecule-details-header">Location</p>
                                    <p>{{currentPDFName}}{{molecule.Location}}</p>
                                  </div>
                                  <div>
                                    <p class="molecule-details-header">Other Instances</p>
                                    <p>{{currentPDFName}} | page(s): {{molecule.OtherInstances.join(', ')}}</p>
                                  </div>
                                </div>
                                <div class="molecule-details-col2">
                                  <div>
                                    <p class="molecule-details-header">Molecular Information</p>
                                    <p>Formula: {{molecule.molecularFormula}}
                                      Weight: {{molecule.molecularWeight}} g/mol</p>
                                  </div>
                                  <div>
                                    <p class="molecule-details-header">Chemical Safety</p>
                                    <p *ngIf="molecule.chemicalSafety.length > 0"><span *ngFor="let chemicalSafetyProperty of molecule.chemicalSafety">{{chemicalSafetyProperty}}</span></p>
                                    <p *ngIf="molecule.chemicalSafety.length == 0">Unavailable</p>
                                  </div>
                                  <div>
                                    <p class="molecule-details-header">External References</p>
                                    <p>PubChem ID: {{molecule.PubChemCID}}</p>
                                  </div>
                                </div>
                                <div [ngClass]="splitView ? 'molecule-details-row2' : 'molecule-details-col3'">
                                  <p class="molecule-details-header">Description</p>
                                  <p>{{molecule.Description}}</p>
                                </div>
                              </div>
                            </p-panel>
                          </div>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
          </p-panel>

          <p-sidebar [(visible)]="filterPanelVisible" position="right">
            <h3>Right Sidebar</h3>
          </p-sidebar>

          <div class="failJob" *ngIf="failedJob">
              <p-messages [(value)]="jobFailedMessage" [enableService]="false" [closable]="false"></p-messages>
          </div>
        </ng-container>
    </div>
</div>
